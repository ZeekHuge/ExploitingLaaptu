#define targetFile "C:/Users/Zubeen/Desktop/ExploitingLaapto/others/output.html"
#include <stdlib.h>
#include <stdio.h>
#include "..\include\zeek_find_helper.h"

#include "..\include\curl\curl.h"
#define freeze  \
	{ \
	fprintf(stderr,".\n............Freezed............\n");  \
	getch(); \
	}





/***********************************************************************************************/
//********* Variable declarations *************//



CURL *curl;
CURLcode res;

struct curl_slist *headers=NULL, *headers1=NULL;


char search_for[100][1000];
char get_in[100][1000];


void perform_data_transfer()
{
      res = curl_easy_perform(curl);

      if(res != CURLE_OK)
	fprintf(stderr, "curl_easy_perform() failed: %s\n",curl_easy_strerror(res));
}


void prepare_headers_1(void)
{
 headers1 = curl_slist_append(headers, "User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0"); 
 headers1 = curl_slist_append(headers, "Referer: http://u.laaptu.com/login22.action");
 headers1 = curl_slist_append(headers, "Accept: image/png,image/*;q=0.8,*/*;q=0.5");
 headers1 = curl_slist_append(headers, "Accept-Language: en-US,en;q=0.5");
 headers1 = curl_slist_append(headers, "Connection: keep-alive");
}

void prepare_headers_2(void)
{
 headers = curl_slist_append(headers, "User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0"); 
 headers = curl_slist_append(headers, "Referer: http://u.laaptu.com/login22.action");
 headers = curl_slist_append(headers, "Accept: text/html");
 headers = curl_slist_append(headers, "Accept-Language: en-US,en;q=0.5");
 headers = curl_slist_append(headers, "Connection: keep-alive");
}


void request_1(void)
{
 //prepare_headers_1() ;
 //headers=NULL;
  
 //curl_easy_setopt(curl, CURLOPT_URL, "http://u.laaptu.com/Validaccount.action?id=3A35022EDD2CCE3C67FD4F4D23FE7F33.LT02");
 curl_easy_setopt(curl, CURLOPT_VERBOSE, 1L);
 curl_easy_setopt(curl, CURLOPT_COOKIEFILE, "C:/Users/Zubeen/Desktop/ExploitingLaapto/cookieFile.txt"); 
 curl_easy_setopt(curl, CURLOPT_COOKIEJAR, "C:/Users/Zubeen/Desktop/ExploitingLaapto/cookieFile.txt"); 
 curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1L);
 curl_easy_setopt(curl, CURLOPT_SSL_VERIFYPEER, 0L);
 curl_easy_setopt(curl, CURLOPT_SSL_VERIFYHOST, 0L);
 curl_easy_setopt(curl, CURLOPT_HTTPHEADER, headers) ; 
 curl_easy_setopt(curl, CURLOPT_HTTPGET, 1L) ;
// curl_easy_setopt(curl, CURLOPT_HTTPPOST, 0L) ;
// curl_easy_setopt(curl, CURLOPT_PUT, 0L);
// curl_easy_setopt(curl, CURLOPT_POST, 1L);
// curl_easy_setopt(curl, CURLOPT_POSTFIELDS, "username=me.zubeen3%40gmail%2Ccom&password=3vartika");

perform_data_transfer();
}




void request_2(void)
{
 curl_easy_setopt(curl, CURLOPT_VERBOSE, 1L);
 curl_easy_setopt(curl, CURLOPT_COOKIEFILE, "C:/Users/Zubeen/Desktop/ExploitingLaapto/cookieFile.txt"); 
 curl_easy_setopt(curl, CURLOPT_COOKIEJAR, "C:/Users/Zubeen/Desktop/ExploitingLaapto/cookieFile.txt"); 
 curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1L);
 curl_easy_setopt(curl, CURLOPT_SSL_VERIFYPEER, 0L);
 curl_easy_setopt(curl, CURLOPT_SSL_VERIFYHOST, 0L);
 curl_easy_setopt(curl, CURLOPT_HTTPHEADER, headers) ; 
// curl_easy_setopt(curl, CURLOPT_HTTPGET, 1L) ;
// curl_easy_setopt(curl, CURLOPT_HTTPPOST, 0L) ;
// curl_easy_setopt(curl, CURLOPT_PUT, 0L);
 curl_easy_setopt(curl, CURLOPT_POST, 1L);
 //curl_easy_setopt(curl, CURLOPT_POSTFIELDS, "username=me.zubeen3%40gmail.com&password=3vartika");

 perform_data_transfer();
}











void testfnc()
{
	char arr[][100]={"loadcap.jpg"}, getIn[1][100];
	int num = 0;
	output_file= fopen(targetFile, "r");
	wordChange1 ='\'' ;
	wordChange2 ='?';
	int t=95;
	//while(t--)
	{find (arr, 1, &num, getIn);
	printf("--%s--\n",&getIn[0][0]);
	}
	exit(0);
}








	
int main(void)
{

//	testfnc();
	char add[100] = {"http://u.laaptu.com/loadcap.jpg?pd="};
	char str[100];
	char secure_code[50]= {"secure_code="} ;  
	
curl_global_init(CURL_GLOBAL_ALL);
 
 curl = curl_easy_init();
	
	if(curl) 
	{
		//...........................................................................................................................................................................................................................................Starting the program
		
		prepare_headers_2();
		freopen("C:/Users/Zubeen/Desktop/ExploitingLaapto/others/output.html","w",stdout );
		
		
		//...........................................................................................................................................................................................................................................going thru fiddler

		//curl_easy_setopt(curl, CURLOPT_PROXY, "127.0.0.1:8888");
        //curl_easy_setopt(curl, CURLOPT_HTTPPROXYTUNNEL, 0L);
		
		
		//...............................................................................................................................................................................................................................................giong to login

		curl_easy_setopt(curl, CURLOPT_POSTFIELDS, "username=me.zubeen3%40gmail.com&password=3vartika");
		curl_easy_setopt(curl, CURLOPT_URL, "http://u.laaptu.com/login.action");
		request_2();
		fclose(stdout);
		system("C:/Users/Zubeen/Desktop/ExploitingLaapto/others/output.html");

		
		//..................................................................................................................................................................................................................................getting the captcha image

		fprintf(stderr, "\n tell the loadCaptcha number\n");
		scanf("%s", str);
		strcat(add,str);
		freopen("C:/Users/Zubeen/Desktop/ExploitingLaapto/others/captcha.png","wb",stdout );
		curl_easy_setopt(curl, CURLOPT_URL, add);
		request_1();
		fclose(stdout);
		
		
		//..................................................................................................................................................................................................................................getting text from captcha

		system("C:/Users/Zubeen/Desktop/ExploitingLaapto/others/captcha.png");
		fprintf(stderr,"\n -----Enter captcha code\n") ;
		scanf("%s",str);
		strcat(secure_code, str) ;
		
		
		//..................................................................................................................................................................................................................................going to inside page and answering the captcha

		freopen("C:/Users/Zubeen/Desktop/ExploitingLaapto/others/output.html","w",stdout );
		curl_easy_setopt(curl, CURLOPT_POSTFIELDS, secure_code);
		curl_easy_setopt(curl, CURLOPT_URL, "http://u.laaptu.com/captvalidate.action");
		request_2();
		curl_easy_cleanup(curl);
		
		
		//..................................................................................................................................................................................................................................going to the 1st quiz

		fclose(stdout);
		system("C:/Users/Zubeen/Desktop/ExploitingLaapto/others/output.html");
		
		
	}
 
  curl_global_cleanup();
 
  return 0;
}


