

#define test "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"
#define targetFile "C:/Users/Zubeen/Desktop/ExploitingLaapto/others/output.html"
#define textOptions "C:/Users/Zubeen/Desktop/ExploitingLaapto/others/options.txt"
#define optionsImage "C:/Users/Zubeen/Desktop/ExploitingLaapto/others/optionsImage.png"

#include <stdlib.h>
#include <stdio.h>
#include "..\include\zeek_find_helper.h"
#include "..\include\curl\curl.h"

#define freeze  \
	{ \
	fprintf(stderr,"\n............Freezed............\n");  \
	getch(); \
	exit(0);\
	}
	
#define CAPTCHAcode 1
#define GETidentity 2
#define OPTIONSimage 3
#define OPTIONStext 4




/***********************************************************************************************/
//********* Variable declarations *************//



CURL *curl;
CURLcode res;

struct curl_slist *headers=NULL, *headers1=NULL;


char search_for[100][1000];
char get_in[100][1000];
char str[10000];

struct curl_httppost *pic64Upload =NULL , *pic64ptr = NULL ;
struct curl_httppost *picUpload =NULL , *picptr = NULL ;


FILE *fd;

static size_t read_callback (void *ptr, size_t size, size_t nmemb, void *stream )
{
 size_t retcode = fread (ptr, size, nmemb, stream) ;
 fprintf(stderr," *****************runned: %d ",retcode);
 return retcode ;
}






void perform_data_transfer()
{
      res = curl_easy_perform(curl);

      if(res != CURLE_OK)
	fprintf(stderr, "curl_easy_perform() failed: %s\n",curl_easy_strerror(res));
}



void prepare_headers(void)
{
 headers = curl_slist_append(headers, "User-Agent: Mozilla/5.0 (Windows NT 6.3; WOW64; rv:35.0) Gecko/20100101 Firefox/35.0"); 
 headers = curl_slist_append(headers, "Referer: http://u.laaptu.com/login22.action");
 headers = curl_slist_append(headers, "Accept: text/html");
 headers = curl_slist_append(headers, "Accept-Language: en-US,en;q=0.5");
 headers = curl_slist_append(headers, "Connection: keep-alive");
}


void request_1(void)
{
 //prepare_headers_1() ;
 //headers=NULL;
  
 //curl_easy_setopt(curl, CURLOPT_URL, "http://u.laaptu.com/Validaccount.action?id=3A35022EDD2CCE3C67FD4F4D23FE7F33.LT02");
 curl_easy_setopt(curl, CURLOPT_VERBOSE, 1L);
 curl_easy_setopt(curl, CURLOPT_COOKIEFILE, "C:/Users/Zubeen/Desktop/ExploitingLaapto/cookieFile.txt"); 
 curl_easy_setopt(curl, CURLOPT_COOKIEJAR, "C:/Users/Zubeen/Desktop/ExploitingLaapto/cookieFile.txt"); 
 curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1L);
 curl_easy_setopt(curl, CURLOPT_SSL_VERIFYPEER, 0L);
 curl_easy_setopt(curl, CURLOPT_SSL_VERIFYHOST, 0L);
 curl_easy_setopt(curl, CURLOPT_HTTPHEADER, headers) ; 
 curl_easy_setopt(curl, CURLOPT_HTTPGET, 1L) ;
// curl_easy_setopt(curl, CURLOPT_HTTPPOST, 0L) ;
// curl_easy_setopt(curl, CURLOPT_PUT, 0L);
// curl_easy_setopt(curl, CURLOPT_POST, 1L);
// curl_easy_setopt(curl, CURLOPT_POSTFIELDS, "username=me.zubeen3%40gmail%2Ccom&password=3vartika");

perform_data_transfer();
}


void request_2(void)
{
 curl_easy_setopt(curl, CURLOPT_VERBOSE, 1L);
 curl_easy_setopt(curl, CURLOPT_COOKIEFILE, "C:/Users/Zubeen/Desktop/ExploitingLaapto/cookieFile.txt"); 
 curl_easy_setopt(curl, CURLOPT_COOKIEJAR, "C:/Users/Zubeen/Desktop/ExploitingLaapto/cookieFile.txt"); 
 curl_easy_setopt(curl, CURLOPT_FOLLOWLOCATION, 1L);
 curl_easy_setopt(curl, CURLOPT_SSL_VERIFYPEER, 0L);
 curl_easy_setopt(curl, CURLOPT_SSL_VERIFYHOST, 0L);
 curl_easy_setopt(curl, CURLOPT_HTTPHEADER, headers) ; 
// curl_easy_setopt(curl, CURLOPT_HTTPGET, 1L) ;
// curl_easy_setopt(curl, CURLOPT_HTTPPOST, 0L) ;
// curl_easy_setopt(curl, CURLOPT_PUT, 0L);
 curl_easy_setopt(curl, CURLOPT_POST, 1L);
 //curl_easy_setopt(curl, CURLOPT_POSTFIELDS, "username=me.zubeen3%40gmail.com&password=3vartika");

 perform_data_transfer();
}



void curlopt_for_upload(void)
{
	curl_easy_setopt(curl, CURLOPT_URL, "http://www.to-text.net");
	curl_easy_setopt(curl, CURLOPT_HTTPPOST, picUpload);
	curl_easy_setopt(curl, CURLOPT_COOKIEFILE, ""); 
}


void prepare_64pic_upload_postdata(void)
{
 curl_formadd (&pic64Upload ,&pic64ptr ,CURLFORM_COPYNAME, "mimetype", CURLFORM_COPYCONTENTS, "image/png", CURLFORM_END) ;
 curl_formadd (&pic64Upload ,&pic64ptr ,CURLFORM_COPYNAME, "data", CURLFORM_COPYCONTENTS, &str[21], CURLFORM_END) ;
}



void prepare_pic_upload_postdata(void)
{
 curl_formadd (&picUpload ,&picptr ,CURLFORM_COPYNAME, "action", CURLFORM_COPYCONTENTS, "convert", CURLFORM_END) ;
 curl_formadd (&picUpload ,&picptr ,CURLFORM_COPYNAME, "ocr_lang", CURLFORM_COPYCONTENTS, "eng", CURLFORM_END) ;
 curl_formadd (&picUpload ,&picptr ,CURLFORM_COPYNAME, "doc_file", CURLFORM_FILE, optionsImage, CURLFORM_END) ;
}







void request_get_decoded_Image()
{
	prepare_64pic_upload_postdata();
	fclose(stdout);
	freopen(optionsImage,"wb",stdout);
	curl_easy_setopt(curl, CURLOPT_HTTPPOST, pic64Upload);
	curl_easy_setopt(curl, CURLOPT_URL, "http://www.peterdamen.com/base64decode.php");
	perform_data_transfer();
	fclose (stdout);
	freopen(targetFile,"w",stdout);
}



void getData(int choose, char geteen[10000])
{
	char arr[1][100];
	char getIn[1][10000];
	int num , t;
	
	output_file= fopen(targetFile, "r");
	if(output_file==NULL)
	{	printf("couldnt open file");
		exit(0);
	}
	rewind(output_file);
	
	
	
	if (choose == CAPTCHAcode)
	{
		t = 1;
		num = 1 ;
		wordChange1 ='\'' ;
		wordChange2 ='?';
		strcpy(&arr[0][0],"loadcap.jpg");
	}
	else if (choose == GETidentity)
	{
		t = 3;
		num = 1 ;
		wordChange1 ='\"' ;
		wordChange2 ='?';
		strcpy(&arr[0][0],"quizcontest.action");
	}
	else if (choose == OPTIONSimage)
	{
		t = 2;
		num = 2 ;
		wordChange1 ='\"' ;
		wordChange2 ='\"';
		strcpy(&arr[0][0],"optionansimg");
	}
	else if (choose == OPTIONStext)
	{
		t = 1;
		num = 4 ;
		wordChange1 ='<' ;
		wordChange2 ='>';
		strcpy(&arr[0][0],"View Text");
	}
	while(t--)
	{
		find (arr, 1, &num, getIn);
	}
	
	strcpy(&geteen[0],&getIn[0][0]);

	}



//void getOptionsText




void  get_options()
{	
	char addrss[100]={"http://www.to-text.net/"};
	
	fclose(stdout);
	
	freopen(targetFile,"w",stdout);
	prepare_pic_upload_postdata();
	curlopt_for_upload();
	perform_data_transfer();

	fclose(stdout);
	getData(OPTIONStext,str);
	strcat(addrss, &str[29]);
	addrss[strlen(addrss)  - 1] = '\0' ;
	fprintf(stderr,"--%s--",addrss);
	
	freopen(textOptions,"w+",stdout);
	
	curl_easy_setopt(curl, CURLOPT_HTTPGET, 1L) ;
	curl_easy_setopt(curl, CURLOPT_URL, addrss);
	
	perform_data_transfer();
	
	
	
	fclose(stdout);
	system(optionsImage);
	system(textOptions);
}








	
void main(void)
{
	//freopen("C:/Users/Zubeen/Desktop/ExploitingLaapto/others/log.txt","w",stderr);
	char add[100] = {"http://u.laaptu.com/loadcap.jpg?"};
	char funquizAdd[100]={"http://u.laaptu.com/quiz.action?"};
	
	char secure_code[50]= {"secure_code="} ;  
	//output_file=fopen(targetFile,"r");
	//here;
	
	
	curl_global_init(CURL_GLOBAL_ALL);
 
	curl = curl_easy_init();
	
	if(curl) 
	{
	/*	
		wordChange1=' ';
		wordChange2=' ';
	
		fclose(output_file);
		
		output_file = fopen(textOptions, "r") ;
		int t =4 ;
		while(t--)
		{
			get_next_word(str);
			fprintf(stderr,"\n----%s----\n",str);
		}
		freeze ;
		
	*/
		
		
       //...........................................................................................................................................................................................................................................Starting the program
		
	

		prepare_headers();
		freopen("C:/Users/Zubeen/Desktop/ExploitingLaapto/others/output.html","w",stdout );
		
			
		
		//...........................................................................................................................................................................................................................................going thru fiddler

		
		
		fprintf(stderr,"\n Open proxy on fiddler ? = ") ;
		{
			int kllkl;
			//scanf("%d",&kllkl);
			//if(kllkl)
			{
				//curl_easy_setopt(curl, CURLOPT_PROXY, "127.0.0.1:8888");
				//curl_easy_setopt(curl, CURLOPT_HTTPPROXYTUNNEL, 0L);
			}
		}
		
	


		
		
		//...............................................................................................................................................................................................................................................giong to login

		
		
		
		curl_easy_setopt(curl, CURLOPT_POSTFIELDS, "username=rajat.subham.srivastava%40gmail.com&password=rajat");
		curl_easy_setopt(curl, CURLOPT_URL, "http://u.laaptu.com/login.action");
		request_2();
		fclose(stdout);
		//system("C:/Users/Zubeen/Desktop/ExploitingLaapto/others/output.html");

		
		
		
		
		//..................................................................................................................................................................................................................................getting the captcha image

		
		
		fprintf(stderr, "\n getting loadCaptcha number\n");
		getData(CAPTCHAcode, str);
		here;
		strcat(add,str);
		fprintf(stderr,"\ncaptcha address = %s\n",add);
		freopen("C:/Users/Zubeen/Desktop/ExploitingLaapto/others/captcha.png","wb",stdout );
		curl_easy_setopt(curl, CURLOPT_URL, add);
		request_1();
		fclose(stdout);
		
		
		
		//..................................................................................................................................................................................................................................getting text from captcha

		
		
		system("C:/Users/Zubeen/Desktop/ExploitingLaapto/others/captcha.png");
		fprintf(stderr,"\n -----Enter captcha code\n") ;
		scanf("%s",str);
		strcat(secure_code, str) ;
		
		
		
		//..................................................................................................................................................................................................................................going to inside page and answering the captcha

		
		
		freopen("C:/Users/Zubeen/Desktop/ExploitingLaapto/others/output.html","w",stdout );
		curl_easy_setopt(curl, CURLOPT_POSTFIELDS, secure_code);
		curl_easy_setopt(curl, CURLOPT_URL, "http://u.laaptu.com/captvalidate.action");
		request_2();
		
		
		
		
		//..................................................................................................................................................................................................................................going to the fun quiz

		
		
		
		fclose(output_file);
		getData(GETidentity, str);
		strcat(funquizAdd,str);
		freopen(targetFile,"w",stdout);
		rewind(stdout);
		curl_easy_setopt(curl, CURLOPT_POSTFIELDS, "Content-Type: application/x-www-form-urlencodedContent-Length: 0");
		curl_easy_setopt(curl, CURLOPT_URL, funquizAdd);
		request_2();
		
		
		
		//................................................................................................................................................................................................................................getting the options form image
		
		getData(OPTIONSimage, str);
		fprintf(stderr,"\n--%s--\n",str);
		request_get_decoded_Image();
		get_options();
		
		
		fclose(stdout);
		system(optionsImage);
		
		
		
		//
		
		curl_easy_cleanup(curl);
	}
 
  curl_global_cleanup();
 
  //return 0;
}


